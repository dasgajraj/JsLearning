<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>API Request ‚Äì XMLHttpRequest</title>
  <style>
    body {
      background-color: #111;
      color: white;
      font-family: Arial, sans-serif;
      padding: 2rem;
    }
    button {
      padding: 10px 20px;
      background: #00ffcc;
      border: none;
      cursor: pointer;
      font-size: 1rem;
      margin-bottom: 20px;
    }
    .user-card {
      background: #222;
      padding: 20px;
      border-left: 4px solid #00ffcc;
      margin-top: 20px;
      display: flex;
      align-items: center;
    }
    .user-card img {
      border-radius: 50%;
      margin-right: 20px;
    }
  </style>
</head>
<body>

  <h1>üë§ Fetch Random User (Using XMLHttpRequest)</h1>
  <button onclick="fetchUser()">üîÑ Get Random User</button>

  <div id="userData"></div>

  <script>
    // üîÅ Function to fetch random user using old method (XMLHttpRequest)
    function fetchUser() {
      // 1Ô∏è‚É£ Create new XMLHttpRequest object
      const xhr = new XMLHttpRequest();

      // 2Ô∏è‚É£ API endpoint (GET a random user)
      const url = "https://randomuser.me/api/";

      /*
        3Ô∏è‚É£ xhr.open(method, url)
        - 'GET' means we want to read/fetch data
        - url is the endpoint
        - async (3rd param, optional) is true by default
      */
      xhr.open("GET", url);

      /*
        4Ô∏è‚É£ Define what happens when request state changes
        - readyState values:
          0: UNSENT
          1: OPENED
          2: HEADERS_RECEIVED
          3: LOADING
          4: DONE
      */
      xhr.onreadystatechange = function () {
        // 5Ô∏è‚É£ Check if request is DONE (readyState = 4)
        if (xhr.readyState === 4) {

          // 6Ô∏è‚É£ Check if status is OK (200 = success)
          if (xhr.status === 200) {
            // 7Ô∏è‚É£ Convert raw JSON string into JS object
            const response = JSON.parse(xhr.responseText);
            const user = response.results[0]; // take first user from array

            // 8Ô∏è‚É£ Destructure data
            const fullName = `${user.name.title} ${user.name.first} ${user.name.last}`;
            const email = user.email;
            const phone = user.phone;
            const city = user.location.city;
            const country = user.location.country;
            const image = user.picture.large;

            // 9Ô∏è‚É£ Display data in the DOM
            document.getElementById("userData").innerHTML = `
              <div class="user-card">
                <img src="${image}" width="100" alt="User Image" />
                <div>
                  <h2>${fullName}</h2>
                  <p>üìß ${email}</p>
                  <p>üìû ${phone}</p>
                  <p>üìç ${city}, ${country}</p>
                </div>
              </div>
            `;
          } else {
            // üî¥ Error handling
            document.getElementById("userData").innerHTML = "<p>‚ùå Failed to fetch user data. Try again.</p>";
          }
        }
      };

      /*
        10Ô∏è‚É£ Send the request
        - This line actually fires the HTTP request
      */
      xhr.send();
    }
  </script>

</body>
</html>
